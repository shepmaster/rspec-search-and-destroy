#!/usr/bin/env ruby

require 'rspec-sad'

require 'rspec-search-and-destroy/binary_chop_example_selector'
require 'rspec-search-and-destroy/rspec_driver'
require 'rspec-search-and-destroy/bisector'

include RSpecSearchAndDestroy

class TTYOutput
  def found(causal_example, failed_example)
    puts "Culprit found"
    puts "Run    #{causal_example[:location]}"
    puts "Before #{failed_example[:location]}"
  end
end

output = TTYOutput.new
selector = BinaryChopExampleSelector.new
driver = RSpecDriver.new

driver.initial_run
results = driver.load_run_results
raise "no failures found" unless results.failed?

bisector = Bisector.new(output, selector, driver)
bisector.bisect(results.causal_examples, results.failed_example)

driver.cleanup
